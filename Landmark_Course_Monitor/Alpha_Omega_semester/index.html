<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Monitoring Sheet</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Modern professional styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);

            th,
            td {
                border: 1px solid #d1d5db;
                /* gray-300 */
                padding: 0.75rem;
                /* p-3 */
                text-align: left;
                vertical-align: middle;
            }

            th {
                background-color: #f9fafb;
                /* gray-50 */
                font-weight: 600;
                /* font-semibold */
                position: sticky;
                top: 0;
                z-index: 10;
            }

            input[type="number"] {
                width: 100%;
                max-width: 80px;
                padding: 0.75rem;
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                appearance: textfield;
                transition: all 0.2s ease-in-out;
                font-size: 0.875rem;
                font-weight: 500;
            }

            input[type="number"]:focus {
                outline: none;
                border-color: #6366f1;
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            }

            input[type="number"]::-webkit-outer-spin-button,
            input[type="number"]::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            .grade-a {
                background-color: #d1fae5;
                color: #065f46;
            }

            /* green */
            .grade-b {
                background-color: #e0f2fe;
                color: #075985;
            }

            /* light blue */
            .grade-c {
                background-color: #fef3c7;
                color: #92400e;
            }

            /* yellow */
            .grade-d {
                background-color: #fee2e2;
                color: #991b1b;
            }

            /* red */
            .grade-e {
                background-color: #fee2e2;
                color: #991b1b;
            }

            /* red */
            .grade-f {
                background-color: #fecaca;
                color: #991b1b;
                font-weight: bold;
            }

            /* stronger red */
            .gpa-box {
                background-color: #f3f4f6;
                /* gray-100 */
                border-top: 3px solid #6366f1;
                /* indigo-500 */
            }
    </style>
</head>

<body class="bg-gray-100 p-4 sm:p-8">

    <div class="max-w-7xl mx-auto px-4">
        <!-- Main Header -->
        <header class="py-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 text-center mb-2">Academic Performance Dashboard</h1>
            <p class="text-gray-600 text-center">Track and analyze your academic progress across semesters</p>
        </header>

        <!-- Controls and CGPA Card -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Semester Controls -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Semester Selection</h2>
                <div class="space-y-4">
                    <select id="semester-select" aria-label="Select Semester"
                        class="w-full bg-white text-gray-800 font-medium py-3 px-4 rounded-lg border border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                        <option value="alpha">Alpha Semester</option>
                        <option value="omega">Omega Semester</option>
                    </select>
                    <button id="download-csv"
                        class="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                        Export Results
                    </button>
                </div>
            </div>

            <!-- CGPA Display -->
            <div
                class="lg:col-span-2 bg-gradient-to-br from-indigo-600 to-indigo-800 rounded-xl shadow-lg p-6 text-white">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm">
                        <h3 class="text-sm font-medium text-indigo-100 mb-1">Current GPA</h3>
                        <div id="gpa" class="text-3xl font-bold">0.00</div>
                    </div>
                    <div class="text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm">
                        <h3 class="text-sm font-medium text-indigo-100 mb-1">Total Units</h3>
                        <div id="total-units" class="text-3xl font-bold">0</div>
                    </div>
                    <div class="text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm">
                        <h3 class="text-sm font-medium text-indigo-100 mb-1">Grade Points</h3>
                        <div id="total-grade-points" class="text-3xl font-bold">0.0</div>
                    </div>
                </div>
                <div class="mt-6 text-center">
                    <h3 class="text-sm font-medium text-indigo-100 mb-1">Cumulative GPA</h3>
                    <div id="cgpa" class="text-4xl font-bold">0.00</div>
                </div>
            </div>
        </div>

        <!-- Course Table Card -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800">Course Scores</h2>
                <p class="text-sm text-gray-500 mt-1">Enter your scores below (Test 1: max 20, Test 2: max 20, Exam: max
                    60)</p>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full" id="course-table">
                    <thead class="bg-gray-50">
                        <tr>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>S/N</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Course Code</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Course Title</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Units</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Test 1</span>
                                    <span class="text-indigo-500">(20)</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Test 2</span>
                                    <span class="text-indigo-500">(20)</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Exam</span>
                                    <span class="text-indigo-500">(60)</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Total</span>
                                    <span class="text-indigo-500">(100)</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Percentage</span>
                                </div>
                            </th>
                            <th
                                class="group px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-200">
                                <div class="flex items-center gap-2">
                                    <span>Grade</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Course data will be injected here by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- GPA Footer -->
        <footer class="p-6 gpa-box">
            <div class="flex flex-col sm:flex-row justify-end items-center space-y-4 sm:space-y-0 sm:space-x-8">
                <div class="text-center sm:text-right">
                    <div class="text-sm font-medium text-gray-500">Total Units</div>
                    <div id="total-units" class="text-2xl font-bold text-gray-800">0</div>
                </div>
                <div class="text-center sm:text-right">
                    <div class="text-sm font-medium text-gray-500">Total Grade Points</div>
                    <div id="total-grade-points" class="text-2xl font-bold text-gray-800">0.0</div>
                </div>
                <div class="text-center sm:text-right">
                    <div class="text-sm font-medium text-gray-500">GPA</div>
                    <div id="gpa" class="text-3xl font-extrabold text-indigo-600">0.00</div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const courses = [
                { sn: 1, code: 'GST111A', title: 'Communication in English I', units: 2 },
                { sn: 2, code: 'ITE111', title: 'IT Essentials', units: 0 },
                { sn: 3, code: 'COS101', title: 'Introduction to Computing Sciences', units: 3 },
                { sn: 4, code: 'LMU-COS111', title: 'Computer Science and the Society', units: 2 },
                { sn: 5, code: 'LMU-CST111', title: 'Use of Library, Study Skills and Information Communication Technology', units: 2 },
                { sn: 6, code: 'LMU-TMC111', title: 'Total Man Concept I', units: 1 },
                { sn: 7, code: 'MTH101', title: 'Elementary Mathematics 1', units: 2 },
                { sn: 8, code: 'PHY101', title: 'General Physics I', units: 2 },
                { sn: 9, code: 'PHY107', title: 'General Physics Practical I', units: 1 },
                { sn: 10, code: 'STA111', title: 'Descriptive Statistics', units: 3 },
                { sn: 11, code: 'LMU-EDS111', title: 'Entrepreneurial Development Studies I', units: 1 },
                { sn: 12, code: 'GST111', title: 'Communication in English', units: 2 },
                { sn: 13, code: 'ADC111', title: 'Enterprise in Pepper and Leafy Vegetable Production I', units: 1 }
            ];

            const omegaCourses = [
                { sn: 1, code: 'GST121', title: 'Communication in English II', units: 2 },
                { sn: 2, code: 'COS121', title: 'Introduction to Problem Solving', units: 3 },
                { sn: 3, code: 'LMU-CST121', title: 'Introduction to Software Engineering', units: 2 },
                { sn: 4, code: 'LMU-TMC121', title: 'Total Man Concept II', units: 1 },
                { sn: 5, code: 'MTH121', title: 'Elementary Mathematics II', units: 2 },
                { sn: 6, code: 'PHY121', title: 'General Physics II', units: 2 },
                { sn: 7, code: 'PHY127', title: 'General Physics Practical II', units: 1 },
                { sn: 8, code: 'STA121', title: 'Probability I', units: 3 },
                { sn: 9, code: 'CHM121', title: 'General Chemistry II', units: 2 },
                { sn: 10, code: 'LMU-EDS121', title: 'Entrepreneurial Development Studies II', units: 1 },
                { sn: 11, code: 'ADC121', title: 'Enterprise in Pepper and Leafy Vegetable Production II', units: 1 }
            ];

            const tableBody = document.querySelector('#course-table tbody');
            let currentSemester = 'alpha';
            const totalUnitsEl = document.getElementById('total-units');
            const totalGradePointsEl = document.getElementById('total-grade-points');
            const gpaEl = document.getElementById('gpa');

            // Initialize semester data storage
            let semesterData = {
                alpha: { scores: {}, gpa: 0, units: 0, gradePoints: 0 },
                omega: { scores: {}, gpa: 0, units: 0, gradePoints: 0 }
            };

            function populateTable(semester) {
                tableBody.innerHTML = ''; // Clear existing table
                const coursesToUse = semester === 'alpha' ? courses : omegaCourses;

                coursesToUse.forEach(course => {
                    const row = document.createElement('tr');
                    row.id = `row-${course.sn}`;
                    row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${course.sn}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${course.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 unit-cell">${course.units}</td>
                    <td class="px-6 py-4"><input type="number" min="0" max="20" class="score-input test1" data-sn="${course.sn}"></td>
                    <td class="px-6 py-4"><input type="number" min="0" max="20" class="score-input test2" data-sn="${course.sn}"></td>
                    <td class="px-6 py-4"><input type="number" min="0" max="60" class="score-input exam" data-sn="${course.sn}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-800 total-cell" id="total-${course.sn}">0</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 perc-cell" id="perc-${course.sn}">0%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold grade-cell" id="grade-${course.sn}">-</td>
                `;
                    tableBody.appendChild(row);
                });

            });

        // Add event listeners to all score inputs
        document.querySelectorAll('.score-input').forEach(input => {
            input.addEventListener('input', () => {
                const sn = input.dataset.sn;
                updateRow(sn);
            });
        });
            }

        // Initialize with Alpha semester
        populateTable('alpha');

        // Add semester switch functionality
        document.getElementById('semester-select').addEventListener('change', (e) => {
            currentSemester = e.target.value;
            populateTable(currentSemester);
            restoreScores();
            updateGPA();
        });

        function updateRow(sn) {
            const row = document.getElementById(`row-${sn}`);
            const test1 = parseFloat(row.querySelector('.test1').value) || 0;
            const test2 = parseFloat(row.querySelector('.test2').value) || 0;
            const exam = parseFloat(row.querySelector('.exam').value) || 0;

            // Save scores to semester data
            semesterData[currentSemester].scores[sn] = {
                test1, test2, exam
            };

            const total = test1 + test2 + exam;
            const percentage = total; // Since total is already out of 100
            const { grade, gradePoint } = getGrade(percentage);
            const units = parseInt(row.querySelector('.unit-cell').textContent);

            const gradeCell = row.querySelector('.grade-cell');
            gradeCell.textContent = grade;
            // Remove any existing grade-* classes but preserve the base layout classes
            ['grade-a', 'grade-b', 'grade-c', 'grade-d', 'grade-e', 'grade-f'].forEach(c => gradeCell.classList.remove(c));
            gradeCell.classList.add(`grade-${grade.toLowerCase()}`, 'animate-fade-in');

            // Update other cells with animation
            const totalCell = row.querySelector('.total-cell');
            const percCell = row.querySelector('.perc-cell');

            totalCell.textContent = total.toFixed(0);
            percCell.textContent = `${percentage.toFixed(0)}%`;

            [totalCell, percCell].forEach(cell => {
                cell.classList.add('animate-fade-in');
                setTimeout(() => cell.classList.remove('animate-fade-in'), 300);
            });

            // Store grade point for GPA calculation
            gradeCell.dataset.gradePoint = gradePoint;

            updateGPA();
        }

        function getGrade(score) {
            if (score >= 70) return { grade: 'A', gradePoint: 5 };
            if (score >= 60) return { grade: 'B', gradePoint: 4 };
            if (score >= 50) return { grade: 'C', gradePoint: 3 };
            if (score >= 45) return { grade: 'D', gradePoint: 2 };
            if (score >= 40) return { grade: 'E', gradePoint: 1 };
            return { grade: 'F', gradePoint: 0 };
        }

        function updateGPA() {
            let totalUnits = 0;
            let totalPoints = 0;

            document.querySelectorAll('#course-table tbody tr').forEach(row => {
                const unitCell = row.querySelector('.unit-cell');
                const gradeCell = row.querySelector('.grade-cell');

                if (unitCell && gradeCell && gradeCell.dataset.gradePoint !== undefined) {
                    const units = parseInt(unitCell.textContent);
                    // Only count courses with units towards GPA
                    if (units > 0) {
                        const gradePoint = parseFloat(gradeCell.dataset.gradePoint);

                        // Only include in GPA if a grade has been assigned (i.e., score entered)
                        if (gradeCell.textContent !== '-') {
                            totalUnits += units;
                            totalPoints += (gradePoint * units);
                        }
                    }
                }
            });

            const gpa = (totalUnits > 0) ? (totalPoints / totalUnits) : 0;

            // Store semester GPA data
            semesterData[currentSemester].gpa = gpa;
            semesterData[currentSemester].units = totalUnits;
            semesterData[currentSemester].gradePoints = totalPoints;

            // Calculate CGPA
            const totalSemesterUnits = semesterData.alpha.units + semesterData.omega.units;
            const totalSemesterPoints = semesterData.alpha.gradePoints + semesterData.omega.gradePoints;
            const cgpa = (totalSemesterUnits > 0) ? (totalSemesterPoints / totalSemesterUnits) : 0;

            totalUnitsEl.textContent = totalUnits;
            totalGradePointsEl.textContent = totalPoints.toFixed(1);
            gpaEl.textContent = gpa.toFixed(2);
            document.getElementById('cgpa').textContent = cgpa.toFixed(2);
        }

        function restoreScores() {
            const savedScores = semesterData[currentSemester].scores;
            Object.entries(savedScores).forEach(([sn, scores]) => {
                const row = document.getElementById(`row-${sn}`);
                if (row) {
                    row.querySelector('.test1').value = scores.test1;
                    row.querySelector('.test2').value = scores.test2;
                    row.querySelector('.exam').value = scores.exam;
                    updateRow(sn);
                }
            });
        }

        // Initial calculations
        let allUnits = 0;
        courses.forEach(c => allUnits += c.units);
        totalUnitsEl.textContent = allUnits;

        // CSV Download Functionality
        document.getElementById('download-csv').addEventListener('click', () => {
            let csvContent = "data:text/csv;charset=utf-8,";

            // Add both semesters
            ['alpha', 'omega'].forEach(sem => {
                csvContent += `\r\n${sem.toUpperCase()} SEMESTER\r\n`;

                // Headers
                const headers = ["S/N", "Course Code", "Course Title", "Units", "Test 1", "Test 2", "Exam", "Total", "Percentage", "Grade"];
                csvContent += headers.join(",") + "\r\n";

                // Save current semester
                const currentSem = currentSemester;

                // Switch to semester being processed
                currentSemester = sem;
                populateTable(sem);
                restoreScores();

                // Get rows data
                document.querySelectorAll('#course-table tbody tr').forEach(row => {
                    const sn = row.cells[0].textContent;
                    const code = row.cells[1].textContent;
                    const title = `"${row.cells[2].textContent}"`; // Enclose title in quotes for CSV
                    const units = row.cells[3].textContent;
                    const test1 = row.querySelector('.test1').value || 0;
                    const test2 = row.querySelector('.test2').value || 0;
                    const exam = row.querySelector('.exam').value || 0;
                    const total = row.cells[7].textContent;
                    const perc = row.cells[8].textContent;
                    const grade = row.cells[9].textContent;

                    const rowData = [sn, code, title, units, test1, test2, exam, total, perc, grade];
                    csvContent += rowData.join(",") + "\r\n";
                });

                // Add semester GPA info
                csvContent += `\r\nSemester Units,${semesterData[sem].units}\r\n`;
                csvContent += `Semester Grade Points,${semesterData[sem].gradePoints.toFixed(1)}\r\n`;
                csvContent += `Semester GPA,${semesterData[sem].gpa.toFixed(2)}\r\n`;
            });

            // Restore original semester view
            currentSemester = currentSem;
            populateTable(currentSem);

            // Add CGPA Info
            const totalSemesterUnits = semesterData.alpha.units + semesterData.omega.units;
            const totalSemesterPoints = semesterData.alpha.gradePoints + semesterData.omega.gradePoints;
            const cgpa = (totalSemesterUnits > 0) ? (totalSemesterPoints / totalSemesterUnits) : 0;

            csvContent += "\r\nCUMULATIVE SUMMARY\r\n";
            csvContent += `Total Units (All Semesters),${totalSemesterUnits}\r\n`;
            csvContent += `Total Grade Points (All Semesters),${totalSemesterPoints.toFixed(1)}\r\n`;
            csvContent += `CGPA,${cgpa.toFixed(2)}\r\n`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "course_performance.csv");
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link);
        });
        });
    </script>
</body>

</html>